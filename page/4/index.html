<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Artemio&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Artemio&#39;s Blog">
<meta property="og:url" content="https://ostart.github.io/page/4/index.html">
<meta property="og:site_name" content="Artemio&#39;s Blog">
<meta property="og:locale" content="ru_RU">
<meta property="article:author" content="Artem Ostashchenko">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Artemio's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Artemio&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Hi, I&#39;m Artem Ostashchenko, a software developer. I write this blog in Russian</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/ostart/Skills">My Skills</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS-каналы"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Поиск"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Поиск"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://ostart.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-rpm-package" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/12/07/rpm-package/" class="article-date">
  <time class="dt-published" datetime="2021-12-07T10:15:24.000Z" itemprop="datePublished">07-12-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/07/rpm-package/">RPM-пакет</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Пакет RPM - это просто файл, содержащий другие файлы и информацию о них, необходимую для развёртывания файлов в операционной системе. Для сборки RPM-пакета мною использовалась операционная система <strong>CentOS 7</strong>.</p>
<p>На систему требуется установить следующие пакеты:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install rpm-build rpm-devel rpmlint rpmdevtools</span><br></pre></td></tr></table></figure>

<p>Основные команды для сборщика RPM-пакетам содержатся в <a href="https://ostart.github.io/2021/12/07/rpm-spec/">SPEC-файле RPM-пакета</a>.</p>
<p>Для начала работы из домашней директории текущего пользователя выполните команду в терминале:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpmdev-setuptree</span><br></pre></td></tr></table></figure>

<p>В результате выполнения команды в домашней директории текущего пользователя появится папка <strong>rpmbuild</strong> следующей структуры:</p>
<ul>
<li>BUILD</li>
<li>RPMS</li>
<li>SOURCES</li>
<li>SPECS</li>
<li>SRPMS</li>
</ul>
<h2 id="Сборка-RPM-пакета"><a href="#Сборка-RPM-пакета" class="headerlink" title="Сборка RPM-пакета"></a>Сборка RPM-пакета</h2><p>Для сборки потребуется:</p>
<ol>
<li><a href="https://ostart.github.io/2021/12/07/rpm-spec/">SPEC-файл</a> (в нашем случае LinuxInstaller-2.15.2.4.spec), который нужно расположить в папке SPECS</li>
<li>Архив tar.gz (в нашем случае LinuxInstaller-2.15.2.4.tar.gz) с бинарниками, и в нашем случае bash-скриптом <em>install</em>, который нужно расположить в папке SOURCES</li>
</ol>
<p><strong>Важно, чтобы имя архива (в нашем случае LinuxInstaller-2.15.2.4.tar.gz) и указанные в SPEC-файле параметры Name, Version и Release соответствовали друг другу</strong>!</p>
<p>Перед сборкой RPM-пакета рекомендуется применить линтер к SPEC-файлу командой в терминале:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpmlint rpmbuild/SPECS/LinuxInstaller-2.15.2.4.spec</span><br></pre></td></tr></table></figure>
<p>и поправить ошибки и критические замечания обнаруженные линтером в указанном файле.</p>
<p>Для сборки RPM-пакета из домашней директории текущего пользователя выполните следующую команду в терминале:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpmbuild -bb rpmbuild/SPECS/LinuxInstaller-2.15.2.4.spec</span><br></pre></td></tr></table></figure>

<p>Ключ -bb означает, что RPM-пакет будет собираться из готовых бинарников. Также RPM-пакет можно собрать из исходников. SPEC-файл разворачивает бинарники из папки SOURCES в папку BUILD, копирует их в новую папку BUILDROOT и упаковывает их в RPM-пакет, который появится в папке RPMS (подпапке x86_64) в rpm-файле <strong>LinuxInstaller-2.15.2-4.x86_64.rpm</strong>. При установке rpm-пакет разворачивает содержимое во временную папку /tmp/LinuxInstaller-2.15.2.4/, запускает bash-скрипт <em>install</em> командой <code>/bin/bash /tmp/%&#123;name&#125;-%&#123;version&#125;.%&#123;release&#125;/install</code> и после установки удаляет временную папку. Основная логика развёртывания файлов вынесена в bash-скрипт <em>install</em>, несущественного для рассматриваемого здесь вопроса.</p>
<h2 id="Развёртывание-RPM-пакета"><a href="#Развёртывание-RPM-пакета" class="headerlink" title="Развёртывание RPM-пакета"></a>Развёртывание RPM-пакета</h2><p>Развернуть RPM-пакет можно как из терминала под root-пользователем, так и из специальной программы в графической оболочке операционной системы.</p>
<p>Для развёртывания RPM-пакета из терминала выполните под root-пользователем следующую команду:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -i LinuxPrintClientInstaller-2.15.2-4.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>Для удаления RPM-пакета из терминала выполните под root-пользователем следующую команду:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ev LinuxPrintClientInstaller-2.15.2-4</span><br></pre></td></tr></table></figure>

<p><strong>Обратите внимание, что при удалении <em>x86_64.rpm</em> указывать в конце пакета не надо!</strong></p>
<h2 id="Обновление-RPM-пакета"><a href="#Обновление-RPM-пакета" class="headerlink" title="Обновление RPM-пакета"></a>Обновление RPM-пакета</h2><p>Обновление пакета требует собрать версию с большими значениями Version и Release. Обратите внимание, что имя и содержимое архива tar.gz также должены соответствовать этим Version и Release.</p>
<p>Если для обновления использовать GUI операционной системы, то RPM-пакет предыдущей версии будет удалён автоматически в случае успешного развертывания пакета обновления. При установке обновления из командной строки предыдущую версию придётся удалять из операционной системы вручную также из командной строки.</p>
<p>Хорошая <a target="_blank" rel="noopener" href="https://rpm-packaging-guide.github.io/">Инструкция по RPM-пакетам</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/12/07/rpm-package/" data-id="cls34y0f1001uj0vsf53d09kr" data-title="RPM-пакет" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RPM/" rel="tag">RPM</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/" rel="tag">bash</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-left-join" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/18/left-join/" class="article-date">
  <time class="dt-published" datetime="2021-11-18T07:33:24.000Z" itemprop="datePublished">18-11-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/18/left-join/">Выполнение Left Join запросов в LINQ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Всем хорош подход FluentApi при выполнении запросов в LINQ, но одна вещь ему не по зубам. Это выполнение удобных Left Join запросов. Но SQL-style запросы в LINQ позволяют решить данную проблему.</p>
<p>Конструкция join в LINQ даёт INNER JOIN соединение таблиц (если проводить аналогию с SQL). А для LEFT JOIN рассмотрим код, показывающий как решить данную проблему в LINQ:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> salesProducts = </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">from</span> product <span class="keyword">in</span> context.Products</span><br><span class="line">    <span class="keyword">join</span> person <span class="keyword">in</span> context.<span class="function">SalesPeople <span class="title">on</span></span></span><br><span class="line"><span class="function">    (<span class="params">product.Region, product.Type</span>)</span></span><br><span class="line"><span class="function">    <span class="title">equals</span></span></span><br><span class="line"><span class="function">    (<span class="params">person.Region, person.ProductType</span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">into</span> productPeople</span></span><br><span class="line"><span class="function">    <span class="keyword">from</span> productPerson <span class="keyword">in</span> productPeople.<span class="title">DefaultIfEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">select</span> <span class="keyword">new</span></span> </span><br><span class="line">    &#123;</span><br><span class="line">        Person = productPerson?.Name ?? <span class="built_in">string</span>.Empty,</span><br><span class="line">        Product = product.Name,</span><br><span class="line">        product.Region,</span><br><span class="line">        product.Type</span><br><span class="line">    &#125;</span><br><span class="line">).ToList();</span><br></pre></td></tr></table></figure>

<p><strong>DefaultIfEmpty()</strong> как раз и осуществляет LEFT JOIN в случае, если <em>productPerson</em> не имеет соответствующей сущности в таблице продаванов <em>SalesPeople</em>. Результат join запроса, соединяющего сущности таблицы <em>Products</em> с сущностями таблицы <em>SalesPeople</em> помещается во временную переменную <em>productPersons</em> с помощью синтаксической конструкции <code>into productPersons</code> и затем оператор <em>DefaultIfEmpty()</em> в конструкции <code>from productPerson in productPersons.DefaultIfEmpty()</code> помещает null в качестве <em>productPerson</em>, если для указаного продукта не имеется соответствующего продавца. Затем мы формируем с помощью проекции <em>select</em> экземпляр анонимного класса, содержащего допустимые значения в случае отсутствия продавца <em>person</em> у требуемого продукта <em>product</em>. Это достигается с помощью конструкции <code>Person = productPerson?.Name ?? string.Empty</code>, которая позволяет избавиться от последующей проверки значения на null.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/11/18/left-join/" data-id="cls34y0ep000xj0vs4gm087a4" data-title="Выполнение Left Join запросов в LINQ" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LEFTJOIN/" rel="tag">LEFTJOIN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LINQ/" rel="tag">LINQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-progressive-delay-pattern" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/11/18/progressive-delay-pattern/" class="article-date">
  <time class="dt-published" datetime="2021-11-18T06:04:13.000Z" itemprop="datePublished">18-11-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/18/progressive-delay-pattern/">Шаблон увеличивающегося интервала повторения запроса</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Когда в приложении прогнозируется присутствие проблем при запросах по сети и не требуется сдаваться в получении ответа при появлении первой же проблемы, я использую шаблон увеличивающегося интервала повторения запроса. Суть шаблона такова: в случае отсутствия ответа (от МФУ например) в отведённый таймаут приложение ожидает определённый интервал времени и затем пытается отправить запрос снова. Если и во второй раз нет ответа, то ожидаем в два раза дольший интервал времени и т.д. (в три, четыре… Вид прогрессии можно выбрать самостоятельно). Получается, что запросы идут всё реже и реже не перегружая устройство (или сайт) в случае сетевых проблем на его стороне. В случае отсутствия ответов заданное число раз, можно полностью прекратить отправку запросов.</p>
<p>Ниже приводится код условного метода <em>Method</em>. База интервала повторения запроса составляет одну секунду и задана арифметическая прогрессия увеличения интервала. Можно задать геометрическую прогрессию, умножая текущий интервал повторения на 2 каждый раз или даже степенную, возводя базу в степень текущего числа повторений (<code>var currentDelay = Math.Pow(DelayInMilliseconds, tryCounter);</code>). Ожидание реализовано синхронно, а асинхронный вариант ожидания (требующий изменения сигнатуры метода на <em>Task<int> Method()</em>) показан в комментарии.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Method</span>(<span class="params"></span>) <span class="comment">// public static Task&lt;int&gt; Method()</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">int</span> DelayInMilliseconds = <span class="number">1000</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">int</span> RetryCount = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">bool</span> success = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> tryCounter = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> response;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">try</span></span><br><span class="line">          &#123;</span><br><span class="line">              response = <span class="comment">// Http запрос к сайту, устройству или т.п.</span></span><br><span class="line">              success = <span class="literal">true</span>;</span><br><span class="line">          &#125; </span><br><span class="line">          catch(HttpRequestException ex) <span class="keyword">when</span> (ex.StatusCode == HttpStatusCode.RequestTimeout)</span><br><span class="line">          &#123;</span><br><span class="line">              tryCounter += <span class="number">1</span>;</span><br><span class="line">              <span class="keyword">var</span> currentDelay = DelayInMilliseconds * tryCounter;</span><br><span class="line">              Thread.Sleep(currentDelay); <span class="comment">// await Task.Delay(currentDelay);</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125; <span class="keyword">while</span>(tryCounter &lt; RetryCount);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> (success)</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> HttpRequestException(<span class="string">&quot;Request failed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Обратите внимание, на двойное обёртывание блоками try-catch-finally самого сетевого запроса. Именно во внешнем блоке finally формируется возвращаемый методом ответ <code>return response;</code>. Иначе он выкидывает наружу исключение HttpRequestException.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/11/18/progressive-delay-pattern/" data-id="cls34y0ew001jj0vsfrlq52j5" data-title="Шаблон увеличивающегося интервала повторения запроса" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ProgressiveDelayPattern/" rel="tag">ProgressiveDelayPattern</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-cursor-paging" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/21/cursor-paging/" class="article-date">
  <time class="dt-published" datetime="2021-10-21T07:59:07.000Z" itemprop="datePublished">21-10-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/21/cursor-paging/">Пагинация с помощью курсора в Entity Framework Core и ASP.NET Core</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>Перевод статьи Халида Абухакмеха (Khalid Abuhakmeh) <a target="_blank" rel="noopener" href="https://khalidabuhakmeh.com/cursor-paging-with-entity-framework-core-and-aspnet-core">Cursor Paging With Entity Framework Core and ASP.NET Core</a></strong>.</p>
<p>При создании API-интерфейсов, которые возвращают значительный объем данных, нам необходимо принимать проектные решения, основываясь на нижележащей базе данных. Например, разработчик может реализовать специальный endpoint в API, который позволит клиентам получать наборы значений из заданного диапазона. Как разработчики API, мы можем выбирать между постраничной пагинацией и пагинацией с помощью курсора.</p>
<p>В этом посте показано, как реализовать оба подхода и почему разбиение по страницам с помощью курсора - это более предпочтительный по производительности вариант.</p>
<h2 id="Что-такое-пагинация"><a href="#Что-такое-пагинация" class="headerlink" title="Что такое пагинация?"></a>Что такое пагинация?</h2><p>Для разработчиков, только начинающих создавать управляемые данными API, понятие пагинации, как разбиения на страницы, становится важной для понимания концепцией. Набор значений может быть как ограниченным, так и безграничным.</p>
<p>Ограниченный набор значений имеет предел. Например, семья будет иметь верхнюю границу количества детей. В большинстве случаев в семье бывает 2-4 ребенка. Таким образом, мы, скорее всего, вернем всех детей в едином ответе при построении API на базе семьи.</p>
<p>Безграничный набор значений не имеет предела. Обычно это коллекции, связанные с вводом пользователя, данными временных рядов или другими механизмами. Например, все платформы социальных сетей работают с безграничным ресурсом. Например, в Твиттере твиты отправляют миллионы людей по всей планете одновременно. В этих случаях невозможно вернуть полный набор данных любому клиенту, но вместо этого API создает фрагмент на основе запрашиваемового критерия.</p>
<p>Что касается API, то пагинация - это попытка разработчика предоставить клиенту частичный набор результатов из огромного источника данных, с которым невозможно взаимодействовать как то иначе.</p>
<h2 id="Выбор-правильного-подхода-к-пагинации"><a href="#Выбор-правильного-подхода-к-пагинации" class="headerlink" title="Выбор правильного подхода к пагинации"></a>Выбор правильного подхода к пагинации</h2><p>Существует два подхода к разбиению коллекций на страницы:</p>
<ol>
<li>Пагинация по номеру и размеру страницы</li>
<li>Пагинация с использованием курсора и размера страницы</li>
</ol>
<p>Термин <strong>курсор</strong> переопределён. Его не следует путать с понятием курсора из реляционных баз данных. Хотя идея имеет сходство с реализацией в базе данных, они не связаны между собой.</p>
<p><strong>Курсор</strong> - это идентификатор, который извлекает следующий элемент в наших последовательных запросах пагинации. Таким образом, пользователи могут размышлять об этом отвечая на вопрос: «Что последует за этим идентификатором курсора?»</p>
<p>Давайте рассмотрим на два подхода в формате запроса:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">### Пагинация по номеру и размеру страницы</span><br><span class="line">GET https://localhost:5001/pictures/paging?page=100000&amp;size=10</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">### Пагинация с использованием курсора и размера страницы</span><br><span class="line">GET https://localhost:5001/pictures/cursor?after=999990&amp;size=10</span><br><span class="line">Accept: application/json</span><br></pre></td></tr></table></figure>

<p>Два HTTP-запроса выглядят очень похоже с точки зрения пользователя, но работают принципиально по-разному.</p>
<p>Для запроса пагинации мы вычисляем диапазон в нашем хранилище данных и извлекаем эти элементы. Здесь мы разместим коллекцию изображений, чтобы получить результаты на определенной странице:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query = db</span><br><span class="line">    .Pictures</span><br><span class="line">    .OrderBy(x =&gt; x.Id)</span><br><span class="line">    .Skip((page - <span class="number">1</span>) * size)</span><br><span class="line">    .Take(size);</span><br></pre></td></tr></table></figure>

<p>Хотя данный подход работает, разработчики должны помнить о предостережениях, самым большим из которых является смещение диапазона по мере поступления новых данных. Другая проблема в данном подходе зависит от нижележащей базы данных. При разбиении на страницы с помощью диапазонов база данных должна сканировать всё множество результатов, чтобы вернуть клиенту страницу. Таким образом, когда мы перемещаемся всё ближе к концу коллекции, производительность начинает ухудшаться.</p>
<p>А как работает пагинация с помощью курсора? В отличие от создания диапазона для получения множества результатов, мы используем предыдущий результат для получения следующего. Курсором может быть любое значение, гарантирующее следующий диапазон. Поля, такие как авто-инкрементируемые идентификаторы или отметки времени, идеально подходят для пагинации с помощью курсора. Пагинация с помощью  курсора не страдает от проблемы, связанной с тем, что входящие данные искажают наши результаты разбиения по страницам, т.к. наш порядок является детерминированным.</p>
<p>Давайте рассмотрим, как реализовать пагинацию с помощью курсора в виде запроса LINQ:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> query = db</span><br><span class="line">    .Pictures</span><br><span class="line">    .OrderBy(x =&gt; x.Id)</span><br><span class="line">    <span class="comment">// будет задействован индекс</span></span><br><span class="line">    .Where(x =&gt; x.Id &gt; after)</span><br><span class="line">    .Take(size);</span><br></pre></td></tr></table></figure>

<p>Пагинация достаточно дорогостоящая операция, какой бы подход мы не использовали. Вы когда-нибудь задумывались, почему Google перестает показывать страницы результатов поиска после максимум 25 страниц? Что ж, существует способ уменьшения этой стоимости и повышения производительности.</p>
<h2 id="Сравнивая-производительность"><a href="#Сравнивая-производительность" class="headerlink" title="Сравнивая производительность"></a>Сравнивая производительность</h2><p>Один из наиболее заметных недостатков пагинации по номеру и размеру страницы по сравнению с пагинацией с помощью курсора - это влияние на производительность. Давайте сравним две реализации веб-приложения в ASP.NET Core.</p>
<p><strong>Примечание: В этом примере используются минималистические ASP.NET Core API-интерфейсы.</strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> CursorPaging;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Builder;</span><br><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Http;</span><br><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.DependencyInjection;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Hosting;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Extensions.Logging;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> builder = WebApplication.CreateBuilder(args);</span><br><span class="line">builder.Services.AddDbContext&lt;Database&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = builder.Build();</span><br><span class="line"><span class="keyword">await</span> <span class="keyword">using</span> (<span class="keyword">var</span> scope = app.Services.CreateAsyncScope())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> db = scope.ServiceProvider.GetService&lt;Database&gt;();</span><br><span class="line">    <span class="keyword">var</span> logger = scope.ServiceProvider.GetService&lt;ILogger&lt;WebApplication&gt;&gt;();</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">await</span> Database.SeedPictures(db);</span><br><span class="line">    logger.LogInformation(<span class="string">$&quot;Seed operation returned with code <span class="subst">&#123;result&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (app.Environment.IsDevelopment())</span><br><span class="line">&#123;</span><br><span class="line">    app.UseDeveloperExceptionPage();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app</span><br><span class="line">    .UseDefaultFiles()</span><br><span class="line">    .UseStaticFiles();</span><br><span class="line"></span><br><span class="line">app.MapGet(<span class="string">&quot;/pictures/paging&quot;</span>, <span class="keyword">async</span> http =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> page = http.Request.Query.TryGetValue(<span class="string">&quot;page&quot;</span>, <span class="keyword">out</span> <span class="keyword">var</span> pages)</span><br><span class="line">        ? <span class="built_in">int</span>.Parse(pages.FirstOrDefault() ?? <span class="built_in">string</span>.Empty)</span><br><span class="line">        : <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> size = http.Request.Query.TryGetValue(<span class="string">&quot;size&quot;</span>, <span class="keyword">out</span> <span class="keyword">var</span> sizes)</span><br><span class="line">        ? <span class="built_in">int</span>.Parse(sizes.FirstOrDefault() ?? <span class="built_in">string</span>.Empty)</span><br><span class="line">        : <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">using</span> <span class="keyword">var</span> db = http.RequestServices.GetRequiredService&lt;Database&gt;();</span><br><span class="line">    <span class="keyword">var</span> total = <span class="keyword">await</span> db.Pictures.CountAsync();</span><br><span class="line">    <span class="keyword">var</span> query = db</span><br><span class="line">        .Pictures</span><br><span class="line">        .OrderBy(x =&gt; x.Id)</span><br><span class="line">        .Skip((page - <span class="number">1</span>) * size)</span><br><span class="line">        .Take(size);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> logger = http.RequestServices.GetRequiredService&lt;ILogger&lt;Database&gt;&gt;();</span><br><span class="line">    logger.LogInformation(<span class="string">$&quot;Using Paging:\n<span class="subst">&#123;query.ToQueryString()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> results = <span class="keyword">await</span> query.ToListAsync();</span><br><span class="line">    <span class="keyword">await</span> http.Response.WriteAsJsonAsync(<span class="keyword">new</span> PagingResult</span><br><span class="line">    &#123;</span><br><span class="line">        Page = page,</span><br><span class="line">        Size = size,</span><br><span class="line">        Pictures = results.ToList(),</span><br><span class="line">        TotalCount = total,</span><br><span class="line">        Sql = query.ToQueryString()</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.MapGet(<span class="string">&quot;/pictures/cursor&quot;</span>, <span class="keyword">async</span> http =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> after = http.Request.Query.TryGetValue(<span class="string">&quot;after&quot;</span>, <span class="keyword">out</span> <span class="keyword">var</span> afters)</span><br><span class="line">        ? <span class="built_in">int</span>.Parse(afters.FirstOrDefault() ?? <span class="built_in">string</span>.Empty)</span><br><span class="line">        : <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> size = http.Request.Query.TryGetValue(<span class="string">&quot;size&quot;</span>, <span class="keyword">out</span> <span class="keyword">var</span> sizes)</span><br><span class="line">        ? <span class="built_in">int</span>.Parse(sizes.FirstOrDefault() ?? <span class="built_in">string</span>.Empty)</span><br><span class="line">        : <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> <span class="keyword">using</span> <span class="keyword">var</span> db = http.RequestServices.GetRequiredService&lt;Database&gt;();</span><br><span class="line">    <span class="keyword">var</span> logger = http.RequestServices.GetRequiredService&lt;ILogger&lt;Database&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> total = <span class="keyword">await</span> db.Pictures.CountAsync();</span><br><span class="line">    <span class="keyword">var</span> query = db</span><br><span class="line">        .Pictures</span><br><span class="line">        .OrderBy(x =&gt; x.Id)</span><br><span class="line">        <span class="comment">// will use the index</span></span><br><span class="line">        .Where(x =&gt; x.Id &gt; after)</span><br><span class="line">        .Take(size);</span><br><span class="line"></span><br><span class="line">    logger.LogInformation(<span class="string">$&quot;Using Cursor:\n<span class="subst">&#123;query.ToQueryString()&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> results = <span class="keyword">await</span> query.ToListAsync();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> http.Response.WriteAsJsonAsync(<span class="keyword">new</span> CursorResult</span><br><span class="line">    &#123;</span><br><span class="line">        TotalCount = total,</span><br><span class="line">        Pictures = results,</span><br><span class="line">        Cursor = <span class="keyword">new</span> CursorResult.CursorItems</span><br><span class="line">        &#123;</span><br><span class="line">            After = results.Select(x =&gt; (<span class="built_in">int</span>?) x.Id).LastOrDefault(),</span><br><span class="line">            Before = results.Select(x =&gt; (<span class="built_in">int</span>?) x.Id).FirstOrDefault()</span><br><span class="line">        &#125;,</span><br><span class="line">        Sql = query.ToQueryString()</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.Run();</span><br></pre></td></tr></table></figure>

<p>Разместим в нашей базе данных SQLite миллион строк и попытаемся постранично продвинуться по коллекции как можно глубже.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">### Пагинация по номеру и размеру страницы</span><br><span class="line">GET https://localhost:5001/pictures/paging?page=100000&amp;size=10</span><br><span class="line">Accept: application/json</span><br><span class="line"></span><br><span class="line">### Пагинация с использованием курсора и размера страницы</span><br><span class="line">GET https://localhost:5001/pictures/cursor?after=999990&amp;size=10</span><br><span class="line">Accept: application/json</span><br></pre></td></tr></table></figure>

<p>Каковы результаты этого эксперимента?</p>
<p>Для нашего запроса страница/размер мы видим общее время ответа 225 мс.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Date: Wed, 23 Jun 2021 12:46:27 GMT</span><br><span class="line">Server: Kestrel</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">&gt; 2021-06-23T084627.200.json</span><br><span class="line"></span><br><span class="line">Response code: 200 (OK); Time: 225ms; Content length: 1328 bytes</span><br></pre></td></tr></table></figure>

<p>Посмотрим, как курсор поведёт себя в подобной ситуации?</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json; charset=utf-8</span><br><span class="line">Date: Wed, 23 Jun 2021 12:46:27 GMT</span><br><span class="line">Server: Kestrel</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line"></span><br><span class="line">&gt; 2021-06-23T084627-1.200.json</span><br><span class="line"></span><br><span class="line">Response code: 200 (OK); Time: 52ms; Content length: 1370 bytes</span><br></pre></td></tr></table></figure>

<p>Ого! 52 мс против 225 мс! Это существенная разница при том же результате. Откуда же возникло это улучшение производительности? Давайте рассмотрим SQL запросы, сгенерированные EF Core, и сравним их.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Использование страницы/размера</span></span><br><span class="line">.param <span class="keyword">set</span> @__p_1 <span class="number">10</span></span><br><span class="line">.param <span class="keyword">set</span> @__p_0 <span class="number">999990</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> &quot;p&quot;.&quot;Id&quot;, &quot;p&quot;.&quot;Created&quot;, &quot;p&quot;.&quot;Url&quot;</span><br><span class="line"><span class="keyword">FROM</span> &quot;Pictures&quot; <span class="keyword">AS</span> &quot;p&quot;</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> &quot;p&quot;.&quot;Id&quot;</span><br><span class="line">LIMIT @__p_1 <span class="keyword">OFFSET</span> @__p_0</span><br><span class="line"></span><br><span class="line"><span class="comment">-- Использование курсора</span></span><br><span class="line">.param <span class="keyword">set</span> @__after_0 <span class="number">999990</span></span><br><span class="line">.param <span class="keyword">set</span> @__p_1 <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> &quot;p&quot;.&quot;Id&quot;, &quot;p&quot;.&quot;Created&quot;, &quot;p&quot;.&quot;Url&quot;</span><br><span class="line"><span class="keyword">FROM</span> &quot;Pictures&quot; <span class="keyword">AS</span> &quot;p&quot;</span><br><span class="line"><span class="keyword">WHERE</span> &quot;p&quot;.&quot;Id&quot; <span class="operator">&gt;</span> @__after_0</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> &quot;p&quot;.&quot;Id&quot;</span><br><span class="line">LIMIT @__p_1</span><br></pre></td></tr></table></figure>

<p>Видно, что первый запрос (страница/размер) использует ключевое слово OFFSET. Это ключевое слово говорит нашему провайдеру базы данных SQLite сканировать до смещения перед вызовом ключевого слова LIMIT. Как можно себе представить, сканирование таблицы из миллиона строк достаточно дорогостоящая операция.</p>
<p>Для запроса с курсором видно, что используется столбец Id с условием WHERE. Использование индекса позволяет SQLite эффективно перемещаться по таблице, обеспечивая и более эффективное выполнение запроса.</p>
<h2 id="Заключение"><a href="#Заключение" class="headerlink" title="Заключение"></a>Заключение</h2><p>Как мы видели в примерах выше, пагинация с помощью курсора становится более производительной по мере увеличения объ<br>ёма данных. Тем не менее, пагинация с использованием страницы и размера может имееть свое место в приложениях. Этот подход намного проще реализовать и для небольших наборов данных, которые меняются нечасто, это может быть отличным выбором. Как разработчики, мы обязаны выбрать лучший вариант для нашего сценария. Тем не менее, учитывая почти четырехкратное улучшение производительности запросов, трудно поспорить с пагинацией с помощью курсора.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/10/21/cursor-paging/" data-id="cls34y0ee000aj0vs5vib6dlq" data-title="Пагинация с помощью курсора в Entity Framework Core и ASP.NET Core" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/EntityFramework/" rel="tag">EntityFramework</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/cursor/" rel="tag">cursor</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/paging/" rel="tag">paging</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-owin" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/07/owin/" class="article-date">
  <time class="dt-published" datetime="2021-10-07T11:09:48.000Z" itemprop="datePublished">07-10-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/07/owin/">Добавляем WebAPI в Windows-службу</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>В предыдущей статье мы рассмотрели <a href="https://ostart.github.io/2021/09/30/topshelf/">создание Windows-службы с помощью фреймворка TopShelf</a>. Но затем мне поднадобилось добавить возможности WebAPI в нашу службу. Рассмотрим как это можно сделать. </p>
<p>Тут нам поможет <em>OWIN</em>. С помощью <strong>NuGet Package Manager</strong> устанавливаем пакет в наш проект службы:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nuget <span class="built_in">Install-Package</span> Microsoft.AspNet.WebApi.OwinSelfHost </span><br></pre></td></tr></table></figure>

<p>Затем конфигурируем наш self-host WebAPI путём создания <em>Startup.cs</em> файла следующего вида:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Net.Http.Formatting;</span><br><span class="line"><span class="keyword">using</span> Owin;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http.Cors;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json.Converters;</span><br><span class="line"><span class="keyword">using</span> Newtonsoft.Json.Serialization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Startup</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Don&#x27;t delete! This code configures Web API. </span></span><br><span class="line">    <span class="comment">// The Startup class is specified as a type parameter in the WebApp.Start method</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configuration</span>(<span class="params">IAppBuilder appBuilder</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> config = <span class="keyword">new</span> HttpConfiguration(); <span class="comment">// Configure Web API for self-host</span></span><br><span class="line">        config.Routes.MapHttpRoute(</span><br><span class="line">            name: <span class="string">&quot;DefaultApi&quot;</span>,</span><br><span class="line">            routeTemplate: <span class="string">&quot;api/&#123;controller&#125;/&#123;id&#125;&quot;</span>,</span><br><span class="line">            defaults: <span class="keyword">new</span> &#123; id = RouteParameter.Optional &#125;</span><br><span class="line">        );</span><br><span class="line">        config.Formatters.Clear();</span><br><span class="line">        config.Formatters.Add(<span class="keyword">new</span> JsonMediaTypeFormatter());</span><br><span class="line">        config.Formatters.JsonFormatter.SerializerSettings =</span><br><span class="line">            <span class="keyword">new</span> JsonSerializerSettings</span><br><span class="line">            &#123;</span><br><span class="line">                ContractResolver = <span class="keyword">new</span> CamelCasePropertyNamesContractResolver()</span><br><span class="line">            &#125;;</span><br><span class="line">        config.Formatters.JsonFormatter.SerializerSettings.Converters.Add(<span class="keyword">new</span> StringEnumConverter());</span><br><span class="line">        <span class="keyword">var</span> cors = <span class="keyword">new</span> EnableCorsAttribute(<span class="string">&quot;*&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        config.EnableCors(cors);</span><br><span class="line">        appBuilder.UseWebApi(config);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Выше происходит настройка роутинга, JSON формата запроса/ответа и cors.</p>
<p>Далее в проект требуется добавить WebAPI контроллер. Для примера возьмём контроллер из <a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/hosting-aspnet-web-api/use-owin-to-self-host-web-api">оригинальной статьи на сайте Microsoft</a>, т.к. используемые мною контроллеры только загромоздят суть повествования излишним содержимым:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ValuesController</span> : <span class="title">ApiController</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="comment">// GET api/values </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="built_in">string</span>&gt; <span class="title">Get</span>(<span class="params"></span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;value1&quot;</span>, <span class="string">&quot;value2&quot;</span> &#125;; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// GET api/values/5 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Get</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;value&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// POST api/values </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Post</span>(<span class="params">[FromBody]<span class="built_in">string</span> <span class="keyword">value</span></span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// PUT api/values/5 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Put</span>(<span class="params"><span class="built_in">int</span> id, [FromBody]<span class="built_in">string</span> <span class="keyword">value</span></span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// DELETE api/values/5 </span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="built_in">int</span> id</span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Теперь отредактируем Program.cs файл Windows-службы для одновременного запуска с WebAPI:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Topshelf;</span><br><span class="line"><span class="keyword">using</span> Microsoft.Owin.Hosting;</span><br><span class="line"><span class="keyword">using</span> System.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span> </span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> ServiceName = <span class="string">&quot;Authentication and WebAPI service&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"></span>)</span> </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">var</span> port = ConfigurationManager.AppSettings[<span class="string">&quot;Port&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> options = <span class="keyword">new</span> StartOptions();</span><br><span class="line">        options.Urls.Add(<span class="string">$&quot;http://*:<span class="subst">&#123;port&#125;</span>/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">using</span> (WebApp.Start&lt;Startup&gt;(options)) <span class="comment">// Start OWIN host </span></span><br><span class="line">        &#123;</span><br><span class="line">            HostFactory.Run(config =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                config.StartAutomatically(); <span class="comment">// startup type</span></span><br><span class="line">                config.EnableShutdown();</span><br><span class="line">                config.Service&lt;AuthApiService&gt;(service =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    service.ConstructUsing(svc =&gt; <span class="keyword">new</span> AuthApiService());</span><br><span class="line">                    service.WhenStarted(svc =&gt; svc.Start());</span><br><span class="line">                    service.WhenStopped(svc =&gt; svc.Stop());</span><br><span class="line">                &#125;);</span><br><span class="line">                config.RunAsLocalSystem();</span><br><span class="line">                config.SetServiceName(ServiceName);</span><br><span class="line">                config.SetDisplayName(ServiceName);</span><br><span class="line">                config.SetDescription(ServiceName);</span><br><span class="line">                config.EnableServiceRecovery(service =&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    service.OnCrashOnly();</span><br><span class="line">                    service.RestartService(delayInMinutes: <span class="number">0</span>); <span class="comment">// first failure</span></span><br><span class="line">                    service.RestartService(delayInMinutes: <span class="number">0</span>); <span class="comment">// second failure</span></span><br><span class="line">                    service.RestartService(delayInMinutes: <span class="number">1</span>); <span class="comment">// subsequent failures</span></span><br><span class="line">                    service.SetResetPeriod(days: <span class="number">1</span>); <span class="comment">// reset period for restart options</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>В результате WebAPI начинает прослушивать все входящие запросы на порт, считанный из файла конфигурации и работает Windows-служба, разработанная с помощью фреймворка Topshelf. Вот так вота! Или как говорят французы: Вуаля!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/10/07/owin/" data-id="cls34y0eu001ej0vsgvxf5ors" data-title="Добавляем WebAPI в Windows-службу" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OWIN/" rel="tag">OWIN</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WebAPI/" rel="tag">WebAPI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows-service/" rel="tag">Windows-service</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-topshelf" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/30/topshelf/" class="article-date">
  <time class="dt-published" datetime="2021-09-30T13:05:13.000Z" itemprop="datePublished">30-09-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/30/topshelf/">Разрабатываем Windows-службы с помощью TopShelf</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Все, кто сталкивались с разработкой служб для операционной системы Windows, отмечали трудность отладки подобного ПО. Трудности старта разработки кода решаются шаблонами Visual Studio для Windows-служб, но вот сама отладка – очень неудобная. Приходится подключаться к запущеному процессу через Debug –&gt; Attach to Process… , выбирать процесс, ставить точку останова и т.д. Но всё изменилось когда появился <a target="_blank" rel="noopener" href="http://topshelf-project.com/">TopShelf</a>. Этот фреймворк (<em>а именно так они себя величают</em>) позволяет разрабатывать и отлаживать Windows-службы как обычные консольные приложения!</p>
<p>Рассмотрим как разрабатывать Windows-службы с помощью <a target="_blank" rel="noopener" href="http://docs.topshelf-project.com/en/latest/">TopShelf</a>.</p>
<p>Установить TopShelf в ваш проект можно через менеджер пакетов NuGet:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nuget <span class="built_in">Install-Package</span> Topshelf</span><br></pre></td></tr></table></figure>

<p>Посмотреть исходный код фреймворка <strong>TopShelf</strong> можно на <a target="_blank" rel="noopener" href="https://github.com/Topshelf/Topshelf">GitHub</a></p>
<p>Основной класс (в нашем случае <em>AuthApiService</em>) должен содержать методы <code>public void Start()</code> и <code>public void Stop()</code>, которые используются <strong>TopShelf</strong> при старте и остановке службы. В моём случае файл <em>Program.cs</em> же будет иметь следующий вид:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Topshelf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> ServiceName = <span class="string">&quot;Authentication and WebAPI service&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        HostFactory.Run(config =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            config.StartAutomatically(); <span class="comment">// startup type</span></span><br><span class="line">            config.EnableShutdown();</span><br><span class="line">            config.Service&lt;AuthApiService&gt;(service =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                service.ConstructUsing(svc =&gt; <span class="keyword">new</span> AuthApiService());</span><br><span class="line">                service.WhenStarted(svc =&gt; svc.Start());</span><br><span class="line">                service.WhenStopped(svc =&gt; svc.Stop());</span><br><span class="line">            &#125;);</span><br><span class="line">            config.RunAsLocalSystem();</span><br><span class="line">            config.SetServiceName(ServiceName);</span><br><span class="line">            config.SetDisplayName(ServiceName);</span><br><span class="line">            config.SetDescription(ServiceName);</span><br><span class="line">            config.EnableServiceRecovery(service =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                service.OnCrashOnly();</span><br><span class="line">                service.RestartService(delayInMinutes: <span class="number">0</span>); <span class="comment">// first failure</span></span><br><span class="line">                service.RestartService(delayInMinutes: <span class="number">0</span>); <span class="comment">// second failure</span></span><br><span class="line">                service.RestartService(delayInMinutes: <span class="number">1</span>); <span class="comment">// subsequent failures</span></span><br><span class="line">                service.SetResetPeriod(days: <span class="number">1</span>); <span class="comment">// reset period for restart options</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);                                          </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Всю магию делает метод <em>HostFactory.Run</em>. В нём указывается класс основного тела службы с методами <em>Start</em> и <em>Stop</em>, задаётся имя службы и описание в менеджере служб Windows (<em>Services</em>). <strong>TopShelf</strong> позволяет провести почти такую же настройку режима работы службы, которую выполняет менеджер служб Windows, в частности задать из под кого будет запускаться служба <code>RunAsLocalSystem</code> или задать параметры перезапуска в случае падения службы с помощью <code>EnableServiceRecovery</code>.</p>
<p>Установить службу в операционную систему Windows можно из командной строки, запущенной от Администратора, прямо в папке где находится служба командой: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthApiService.exe install</span><br></pre></td></tr></table></figure>

<p>Удалить службу можно командой:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AuthApiService.exe uninstall</span><br></pre></td></tr></table></figure>

<p>Всю магию установки и настройки службы берёт на себя <strong>Topshelf</strong>! </p>
<p>Службу можно установить и самостоятельно, но тогда настройки из раздела <code>EnableServiceRecovery</code> применены не будут.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc create &quot;Authentication and WebAPI service&quot; binPath=&quot;&lt;путь_к_службе&gt;\AuthService.exe&quot;</span><br></pre></td></tr></table></figure>

<p>Удалить службу самостоятельно можно командой:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sc delete &quot;Authentication and WebAPI service&quot;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/09/30/topshelf/" data-id="cls34y0fq002rj0vsh5cddk00" data-title="Разрабатываем Windows-службы с помощью TopShelf" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TopShelf/" rel="tag">TopShelf</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Windows-service/" rel="tag">Windows-service</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-enum-is-defined-csharp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/18/enum-is-defined-csharp/" class="article-date">
  <time class="dt-published" datetime="2021-09-18T06:20:27.000Z" itemprop="datePublished">18-09-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/18/enum-is-defined-csharp/">Enum.IsDefined и его самодельная альтернатива</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Работа с перечислениями <em>Enum</em> в C# имеет очень большие издержки. Это странно, т.к. перечисления целочисленны по своей природе, но из-за требований безопасности типов даже простые операции обходятся дорого. Подробно этот аспект освещён в книге <strong>Бена Уотсона “Высокопроизводительный код на платформе .NET” (2-е издание)</strong> в главе 6 <em>“Использование среды .NET Framework”</em> раздел <em>“Удивительно высокие издержки использования перечислений”</em>. Там рассмотрено внутреннее устройство метода <em>Enum.HasFlag</em>. Анализ же метода <em>Enum.IsDefined</em> оставлен в виде домашнего задания. Займёмся анализом, учтя основную рекомендацию Бена: <strong>“если окажется, что проверять наличие флага приходится часто, реализуйте проверку самостоятельно”</strong>. Посмотрим внутренее устройство <em>Enum.IsDefined</em>, реализуем самодельную альтернативу <em>MyEnum.MyIsDefined</em> и сравним их в деле.</p>
<p><strong>ILSpy</strong> показывает следующее устройство метода <em>Enum.IsDefined</em>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// System.Enum</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">IsDefined</span>(<span class="params">Type enumType, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="built_in">object</span>)enumType == <span class="literal">null</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;enumType&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> enumType.IsEnumDefined(<span class="keyword">value</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// System.Type</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="built_in">bool</span> <span class="title">IsEnumDefined</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">value</span> == <span class="literal">null</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!IsEnum)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(SR.Arg_MustBeEnum, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	Type type = <span class="keyword">value</span>.GetType();</span><br><span class="line">	<span class="keyword">if</span> (type.IsEnum)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (!type.IsEquivalentTo(<span class="keyword">this</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(SR.Format(SR.Arg_EnumAndObjectMustBeSameType, type, <span class="keyword">this</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		type = type.GetEnumUnderlyingType();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (type == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">string</span>[] enumNames = GetEnumNames();</span><br><span class="line">		<span class="built_in">object</span>[] array = enumNames;</span><br><span class="line">		<span class="keyword">if</span> (Array.IndexOf(array, <span class="keyword">value</span>) &gt;= <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (IsIntegerType(type))</span><br><span class="line">	&#123;</span><br><span class="line">		Type enumUnderlyingType = GetEnumUnderlyingType();</span><br><span class="line">		<span class="keyword">if</span> (enumUnderlyingType.GetTypeCodeImpl() != type.GetTypeCodeImpl())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentException(SR.Format(SR.Arg_EnumUnderlyingTypeAndObjectMustBeSameType, type, enumUnderlyingType));</span><br><span class="line">		&#125;</span><br><span class="line">		Array enumRawConstantValues = GetEnumRawConstantValues();</span><br><span class="line">		<span class="keyword">return</span> BinarySearch(enumRawConstantValues, <span class="keyword">value</span>) &gt;= <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">throw</span> <span class="keyword">new</span> InvalidOperationException(SR.InvalidOperation_UnknownEnumType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Выглядит этот код сложно, причем я не привожу ещё реализации многочисленных внутренних функций типа <em>GetEnumUnderlyingType</em>, <em>GetEnumRawConstantValues</em> и др., чтобы не загромождать повествование. Видно, что в <em>Enum.IsDefined</em> можно передать и численное значение <em>int</em>, и имя в виде строки, и аргумент в виде значения преречисления <em>PetType.Dog</em> - во всех случаях метод проверит есть ли такое значение в перечислении (вернёт True, если есть, либо False, если нет).</p>
<p>Реализуем метод <em>Enum.IsDefined</em> самостоятельно. Для этого преобразуем перечисление в словарь <em>equivalentEnumDictionary</em> внутри класса <em>MyEnum</em>. Тогда эквивалентом метода <em>Enum.IsDefined</em> будет метод <em>MyEnum.MyIsDefined</em> с таким же набором входных аргументов:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">EnumSharp</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">MyEnum</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; equivalentEnumDictionary;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">MyIsDefined</span>(<span class="params">Type enumType, <span class="built_in">object</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (equivalentEnumDictionary == <span class="literal">null</span>) </span><br><span class="line">            &#123;</span><br><span class="line">                equivalentEnumDictionary = Enum.GetValues(enumType)</span><br><span class="line">                                               .Cast&lt;<span class="built_in">object</span>&gt;()</span><br><span class="line">                                               .ToDictionary(k =&gt; (<span class="built_in">int</span>)k, v =&gt; ((Enum)v).ToString());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> <span class="keyword">is</span> <span class="built_in">int</span> &amp;&amp; equivalentEnumDictionary.ContainsKey((<span class="built_in">int</span>)<span class="keyword">value</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span> <span class="keyword">is</span> <span class="built_in">string</span> &amp;&amp; equivalentEnumDictionary.ContainsValue((<span class="built_in">string</span>)<span class="keyword">value</span>))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">value</span>.GetType() == enumType &amp;&amp; equivalentEnumDictionary.ContainsValue(<span class="keyword">value</span>.ToString()))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Преобразование перечисления в словарь произойдёт единожды при первом обращении к методу <em>MyEnum.MyIsDefined</em>.</p>
<p><strong>Примечание</strong>: LINQ преобразование в словарь я также пробовал в виде <code>.ToDictionary(k =&gt; (int)k, v =&gt; v.ToString())</code> и <code>.ToDictionary(k =&gt; (int)k, v =&gt; Enum.GetName(enumType, (int)v))</code>. Вариант, представленный в теле метода <em>MyIsDefined</em>, оказался самым шустрым.</p>
<p>Теперь сравним насколько самостоятельная проверка быстрее встроенной. Для этого воспользуемся библиотекой <strong>BenchmarkDotNet</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> BenchmarkDotNet.Attributes;</span><br><span class="line"><span class="keyword">using</span> BenchmarkDotNet.Running;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">EnumSharp</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Flags</span>] </span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> PetType</span><br><span class="line">    &#123;</span><br><span class="line">        None = <span class="number">0</span>, Dog = <span class="number">1</span>, Cat = <span class="number">2</span>, Rodent = <span class="number">4</span>, Bird = <span class="number">8</span>, Reptile = <span class="number">16</span>, Other = <span class="number">32</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EnumsBenchmark</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Benchmark</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MethodEnumIsDefined</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">bool</span> result;</span><br><span class="line"></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), <span class="number">1</span>); <span class="comment">// true</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), <span class="number">64</span>); <span class="comment">// false</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;Rodent&quot;</span>); <span class="comment">// true</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), PetType.Dog); <span class="comment">// true</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), PetType.Dog | PetType.Cat); <span class="comment">// false</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;None&quot;</span>); <span class="comment">// true</span></span><br><span class="line">            result = Enum.IsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;NONE&quot;</span>); <span class="comment">// false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">Benchmark</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MethodMyIsDefined</span>(<span class="params"></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">bool</span> result;</span><br><span class="line"></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), <span class="number">1</span>); <span class="comment">// true</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), <span class="number">64</span>); <span class="comment">// false</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;Rodent&quot;</span>); <span class="comment">// true</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), PetType.Dog); <span class="comment">// true</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), PetType.Dog | PetType.Cat); <span class="comment">// false</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;None&quot;</span>); <span class="comment">// true</span></span><br><span class="line">            result = MyEnum.MyIsDefined(<span class="keyword">typeof</span>(PetType), <span class="string">&quot;NONE&quot;</span>); <span class="comment">// false</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> summary = BenchmarkRunner.Run&lt;EnumsBenchmark&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Вот результаты:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|              Method |     Mean |    Error |   StdDev |</span><br><span class="line">|-------------------- |---------:|---------:|---------:|</span><br><span class="line">| MethodEnumIsDefined | 845.3 ns | 15.14 ns | 13.42 ns |</span><br><span class="line">|   MethodMyIsDefined | 350.2 ns |  6.95 ns |  6.83 ns |</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Получается, что самостоятельная проверка <em>MyEnum.MyIsDefined</em> более чем в два раза быстрее даже при такой прямолинейной реализации. Стоит согласиться с Беном Уотсоном, что если проверять <em>Enum.IsDefined</em> приходится часто, то реализация самостоятельной проверки даст существенную выгоду по быстродействию. При обычном сценарии достаточно пользоваться встроенной <em>Enum.IsDefined</em>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/09/18/enum-is-defined-csharp/" data-id="cls34y0eg000ej0vs1zvj7n9u" data-title="Enum.IsDefined и его самодельная альтернатива" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/BenchmarkDotNet/" rel="tag">BenchmarkDotNet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Enum/" rel="tag">Enum</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ILSpy/" rel="tag">ILSpy</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-add-csharp-nuget-package-vscode" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/17/add-csharp-nuget-package-vscode/" class="article-date">
  <time class="dt-published" datetime="2021-09-17T10:24:36.000Z" itemprop="datePublished">17-09-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/17/add-csharp-nuget-package-vscode/">Добавляем из терминала VSCode NuGet пакеты в C# проект</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Существует возможность создания разнообразных видов проектов <em><strong>.NET 5</strong></em> прямо из терминала <em><strong>VSCode</strong></em>. Терминал можно вызвать горячими клавишами <code>Ctrl+`</code> или с помощью меню <code>View -&gt; Terminal</code>. Взгляните:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">D:\Github\EnumSharp&gt;dotnet new </span><br><span class="line">Template Name                                 Short Name           Language    Tags</span><br><span class="line">--------------------------------------------  -------------------  ----------  ----------------------</span><br><span class="line">Console Application                           console              [C#],F#,VB  Common/Console        </span><br><span class="line">Class library                                 classlib             [C#],F#,VB  Common/Library        </span><br><span class="line">WPF Application                               wpf                  [C#],VB     Common/WPF</span><br><span class="line">WPF Class library                             wpflib               [C#],VB     Common/WPF</span><br><span class="line">WPF Custom Control Library                    wpfcustomcontrollib  [C#],VB     Common/WPF</span><br><span class="line">WPF User Control Library                      wpfusercontrollib    [C#],VB     Common/WPF</span><br><span class="line">Windows Forms App                             winforms             [C#],VB     Common/WinForms       </span><br><span class="line">Windows Forms Control Library                 winformscontrollib   [C#],VB     Common/WinForms       </span><br><span class="line">Windows Forms Class Library                   winformslib          [C#],VB     Common/WinForms       </span><br><span class="line">Worker Service                                worker               [C#],F#     Common/Worker/Web     </span><br><span class="line">MSTest Test Project                           mstest               [C#],F#,VB  Test/MSTest</span><br><span class="line">NUnit 3 Test Project                          nunit                [C#],F#,VB  Test/NUnit</span><br><span class="line">NUnit 3 Test Item                             nunit-test           [C#],F#,VB  Test/NUnit</span><br><span class="line">xUnit Test Project                            xunit                [C#],F#,VB  Test/xUnit</span><br><span class="line">Razor Component                               razorcomponent       [C#]        Web/ASP.NET</span><br><span class="line">Razor Page                                    page                 [C#]        Web/ASP.NET</span><br><span class="line">MVC ViewImports                               viewimports          [C#]        Web/ASP.NET</span><br><span class="line">MVC ViewStart                                 viewstart            [C#]        Web/ASP.NET</span><br><span class="line">Blazor Server App                             blazorserver         [C#]        Web/Blazor</span><br><span class="line">Blazor WebAssembly App                        blazorwasm           [C#]        Web/Blazor/WebAssembly</span><br><span class="line">ASP.NET Core Empty                            web                  [C#],F#     Web/Empty</span><br><span class="line">ASP.NET Core Web App (Model-View-Controller)  mvc                  [C#],F#     Web/MVC</span><br><span class="line">ASP.NET Core Web App                          webapp               [C#]        Web/MVC/Razor Pages   </span><br><span class="line">ASP.NET Core with Angular                     angular              [C#]        Web/MVC/SPA</span><br><span class="line">ASP.NET Core with React.js                    react                [C#]        Web/MVC/SPA</span><br><span class="line">ASP.NET Core with React.js and Redux          reactredux           [C#]        Web/MVC/SPA</span><br><span class="line">Razor Class Library                           razorclasslib        [C#]        Web/Razor/Library     </span><br><span class="line">ASP.NET Core Web API                          webapi               [C#],F#     Web/WebAPI</span><br><span class="line">ASP.NET Core gRPC Service                     grpc                 [C#]        Web/gRPC</span><br><span class="line">dotnet gitignore file                         gitignore                        Config</span><br><span class="line">global.json file                              globaljson                       Config</span><br><span class="line">NuGet Config                                  nugetconfig                      Config</span><br><span class="line">Dotnet local tool manifest file               tool-manifest                    Config</span><br><span class="line">Web Config                                    webconfig                        Config</span><br><span class="line">Solution File                                 sln                              Solution</span><br><span class="line">Protocol Buffer File                          proto                            Web/gRPC</span><br><span class="line"></span><br><span class="line">Examples:</span><br><span class="line">    dotnet new mvc --auth Individual</span><br><span class="line">    dotnet new web </span><br><span class="line">    dotnet new --help</span><br><span class="line">    dotnet new nunit --help</span><br></pre></td></tr></table></figure>

<p>Создадим консольное приложение командой: <code>dotnet new console</code></p>
<p>Но как теперь добавить в наш проект NuGet пакеты также из терминала?! Install-Package не работает :(</p>
<p>Тут нам поможет команда: <code>dotnet add package &lt;ИМЯ_ПАКЕТА&gt;</code></p>
<p>Например, добавим в наш проект пакеты  <strong>BenchmarkDotNet</strong> и <strong>BenchmarkDotNet.Annotations</strong>.<br>Для этого в терминале выполним следующие команды:<br><code>dotnet add package BenchmarkDotNet</code><br><code>dotnet add package BenchmarkDotNet.Annotations</code></p>
<p>Вуаля! Требующиеся NuGet пакеты добавлены в наш проект:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">&quot;Microsoft.NET.Sdk&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">OutputType</span>&gt;</span>Exe<span class="tag">&lt;/<span class="name">OutputType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>net5.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;BenchmarkDotNet&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.13.1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PackageReference</span> <span class="attr">Include</span>=<span class="string">&quot;BenchmarkDotNet.Annotations&quot;</span> <span class="attr">Version</span>=<span class="string">&quot;0.13.1&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ItemGroup</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/09/17/add-csharp-nuget-package-vscode/" data-id="cls34y0dv0000j0vsgzle5tne" data-title="Добавляем из терминала VSCode NuGet пакеты в C# проект" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NuGet/" rel="tag">NuGet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VSCode/" rel="tag">VSCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/net5-0/" rel="tag">net5.0</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-epplus-named-style" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/09/epplus-named-style/" class="article-date">
  <time class="dt-published" datetime="2021-09-09T11:08:53.000Z" itemprop="datePublished">09-09-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/09/epplus-named-style/">Как эффективно выделять ячейки в файлах Excel с помощью EPPlus</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>При построении отчетов в различных системах используется Excel. Для его формирования из C# кода часто используется <a target="_blank" rel="noopener" href="https://epplussoftware.com/">EPPlus</a>. EPPlus интуитивно понятен:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> file = <span class="keyword">new</span> FileInfo(<span class="string">@&quot;c:\temp\myWorkbook.xlsx&quot;</span>);</span><br><span class="line"><span class="keyword">using</span>(<span class="keyword">var</span> package = <span class="keyword">new</span> ExcelPackage(file))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> sheet = package.Workbook.Worksheets.Add(<span class="string">&quot;My Sheet&quot;</span>);</span><br><span class="line">    sheet.Cells[<span class="string">&quot;A1&quot;</span>].Value = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Save to file</span></span><br><span class="line">    package.Save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>EPPlus имеет много встроенных механизмов для получения одного и того же результата разными путями, но не все пути одинаково эффективны для больших и очень больших размеров рабочих листов. В частности, я столкнулся с проблемой обведения контуров ячеек и выделения жирным шрифтом документов Excel, содержащих свыше 10000 столбцов.</p>
<p>Используемый мной подход “в лоб” заключался в обводке контуров ячеек непосредственно в месте их заполнения данными с помощью функции DrawBorder:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// использование функции DrawBorder. ПОЛНЫЙ ПРОВАЛ в эффективности!!!</span></span><br><span class="line">DrawBorder(worksheet.Cells[<span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, shift + dateTimeRanges.Count - <span class="number">1</span>], ExcelBorderStyle.Medium, BorderSide.TopBottom);</span><br><span class="line">DrawBorder(worksheet.Cells[<span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, shift + dateTimeRanges.Count - <span class="number">1</span>], ExcelBorderStyle.Thin, BorderSide.LeftRight);</span><br><span class="line">DrawBorder(worksheet.Cells[<span class="number">4</span>, shift + dateTimeRanges.Count - <span class="number">1</span>], ExcelBorderStyle.Medium, BorderSide.Right);</span><br><span class="line"></span><br><span class="line"><span class="comment">// определение функции DrawBorder: НАИВНОЕ и НЕЭФФЕКТИВНОЕ</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">DrawBorder</span>(<span class="params">ExcelRange worksheetCell, ExcelBorderStyle borderStyle, BorderSide side</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (side)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.EveryOne:</span><br><span class="line">            worksheetCell.Style.Border.Top.Style = borderStyle;</span><br><span class="line">            worksheetCell.Style.Border.Left.Style = borderStyle;</span><br><span class="line">            worksheetCell.Style.Border.Right.Style = borderStyle;</span><br><span class="line">            worksheetCell.Style.Border.Bottom.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.Top:</span><br><span class="line">            worksheetCell.Style.Border.Top.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.Left:</span><br><span class="line">            worksheetCell.Style.Border.Left.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.Bottom:</span><br><span class="line">            worksheetCell.Style.Border.Bottom.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.Right:</span><br><span class="line">            worksheetCell.Style.Border.Right.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.TopBottom:</span><br><span class="line">            worksheetCell.Style.Border.Top.Style = borderStyle;</span><br><span class="line">            worksheetCell.Style.Border.Bottom.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> BorderSide.LeftRight:</span><br><span class="line">            worksheetCell.Style.Border.Left.Style = borderStyle;</span><br><span class="line">            worksheetCell.Style.Border.Right.Style = borderStyle;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="literal">default</span>:</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="keyword">nameof</span>(side), side, <span class="literal">null</span>);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Данный подход показал свою <strong>полную неэффективность</strong>. Отчеты строились по часу и более…</p>
<p>Правильный подход заключается в определении именованных стилей NamedStyle и применении этих стилей для конкретных ячеек:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// определение именованных стилей NamedStyle</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">AddNamedStyles</span>(<span class="params">ExcelPackage excel</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> thinBorders = excel.Workbook.Styles.CreateNamedStyle(<span class="string">&quot;ThinBordersStyle&quot;</span>);</span><br><span class="line">    thinBorders.Style.Border.Top.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    thinBorders.Style.Border.Left.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    thinBorders.Style.Border.Right.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    thinBorders.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    thinBorders.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;</span><br><span class="line">    thinBorders.Style.VerticalAlignment = ExcelVerticalAlignment.Center;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> totalThinBoldBorders = excel.Workbook.Styles.CreateNamedStyle(<span class="string">&quot;TotalThinBordersBoldStyle&quot;</span>);</span><br><span class="line">    totalThinBoldBorders.Style.Border.Top.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    totalThinBoldBorders.Style.Border.Left.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    totalThinBoldBorders.Style.Border.Right.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    totalThinBoldBorders.Style.Border.Bottom.Style = ExcelBorderStyle.Thin;</span><br><span class="line">    totalThinBoldBorders.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;</span><br><span class="line">    totalThinBoldBorders.Style.VerticalAlignment = ExcelVerticalAlignment.Center;</span><br><span class="line">    totalThinBoldBorders.Style.Font.Bold = <span class="literal">true</span>;</span><br><span class="line">    totalThinBoldBorders.Style.Font.Size = <span class="number">12</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// использование именованных стилей NamedStyle</span></span><br><span class="line">worksheet.Cells[startRow, <span class="number">1</span>, currentRow - <span class="number">1</span>, shift + dateTimeRanges.Count - <span class="number">1</span>].StyleName = <span class="string">&quot;ThinBordersStyle&quot;</span>;</span><br><span class="line">worksheet.Cells[currentRow, <span class="number">1</span>, currentRow + <span class="number">1</span>, shift + dateTimeRanges.Count - <span class="number">1</span>].StyleName = <span class="string">&quot;TotalThinBordersBoldStyle&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>Использование именованных стилей NamedStyle привело к намного более эффективному построению отчетов Excel. Отчеты стали строиться за 7-10 минут, что почти в 10 раз быстрее первоначального подхода с DrawBorder. Как говорилось в рекламе из 90-х, “не все йогурты одинаково полезны…”</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/09/09/epplus-named-style/" data-id="cls34y0ej000ij0vsclbx36rv" data-title="Как эффективно выделять ячейки в файлах Excel с помощью EPPlus" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/EPPlus/" rel="tag">EPPlus</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Excel/" rel="tag">Excel</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-calendar-53-weeks" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/09/calendar-53-weeks/" class="article-date">
  <time class="dt-published" datetime="2021-09-09T10:00:16.000Z" itemprop="datePublished">09-09-2021</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/09/calendar-53-weeks/">Почему в календаре бывает 53 недели</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Согласно ГОСТ ИСО 8601-2001 “ПРЕДСТАВЛЕНИЕ ДАТ И ВРЕМЕНИ” расчет номера недели в Российской Федерации осуществляется так:</p>
<p><em>Первой неделей года является та неделя, которая содержит число 4 января. То есть если первое января выпадает на пятницу, субботу, или воскресенье, то все еще продолжается последняя неделя предыдущего года.</em></p>
<p>Это может приводить к интересным спецэффектам - в году может содержаться 52 или 53 недели, 29, 30, 31 декабря могут относиться к первой неделе следующего года, и наоборот, 1, 2, и 3 января могут относиться к 52 или 53 неделе прошлого года. В частности 53 недели содержали <strong>2015</strong> и <strong>2020</strong> годы.</p>
<p>Привычный подход к вычислению количества недель в году с помощью Calendar.GetWeekOfYear для нашего ГОСТа даёт сбой и <strong>работает некорректно</strong>. 53-и недели при таком подходе отсустсвуют.</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Такой подход вычисляет 53-ю неделю НЕКОРРЕКТНО</span></span><br><span class="line"><span class="keyword">var</span> ruCi = <span class="keyword">new</span> CultureInfo(<span class="string">&quot;ru-RU&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> ruCal = ruCi.Calendar;</span><br><span class="line"><span class="keyword">var</span> ruCwr = ruCi.DateTimeFormat.CalendarWeekRule;</span><br><span class="line"><span class="keyword">var</span> ruFirstDow = ruCi.DateTimeFormat.FirstDayOfWeek;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; dateTimeRanges.Count; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> year = dateTimeRanges[i].Add(reportDto.ClientOffset).Year.ToString(<span class="string">&quot;D4&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> nn = ruCal.GetWeekOfYear(</span><br><span class="line">        dateTimeRanges[i].Add(reportDto.ClientOffset), </span><br><span class="line">        ruCwr, </span><br><span class="line">        ruFirstDow</span><br><span class="line">    ).ToString(<span class="string">&quot;D2&quot;</span>); <span class="comment">// вычисляет 53-ю неделю НЕКОРРЕКТНО !!!</span></span><br><span class="line">    worksheet.Cells[<span class="number">4</span>, shift + i].Value = <span class="string">$&quot;<span class="subst">&#123;nn&#125;</span>.<span class="subst">&#123;year&#125;</span>&quot;</span>; <span class="comment">// НЕКОРРЕКТНОЕ значение для 53-ей недели!!!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Метод Calendar.GetWeekOfYear вычиляет недели в году не по ГОСТ ИСО 8601-2001 и для календаря РФ не подходит!</strong></p>
<p>Для расчёта недель согласно ГОСТ ИСО 8601-2001 следует использовать статический класс <strong>ISOWeek</strong> и метод <strong>GetWeekOfYear</strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; dateTimeRanges.Count; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> year = ISOWeek.GetYear(dateTimeRanges[i].Add(reportDto.ClientOffset)).ToString(<span class="string">&quot;D4&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> nn = ISOWeek.GetWeekOfYear(</span><br><span class="line">        dateTimeRanges[i].Add(reportDto.ClientOffset)</span><br><span class="line">    ).ToString(<span class="string">&quot;D2&quot;</span>); <span class="comment">// ПРАВИЛЬНОЕ значение для 53-ей недели</span></span><br><span class="line">    worksheet.Cells[<span class="number">4</span>, shift + i].Value = <span class="string">$&quot;<span class="subst">&#123;nn&#125;</span>.<span class="subst">&#123;year&#125;</span>&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Подробнее с <strong>ISOWeek.GetWeekOfYear</strong> можно познакомиться <a target="_blank" rel="noopener" href="https://docs.microsoft.com/ru-ru/dotnet/api/system.globalization.isoweek.getweekofyear?view=net-5.0">по ссылке</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://ostart.github.io/2021/09/09/calendar-53-weeks/" data-id="cls34y0ea0005j0vs1964h6v4" data-title="Почему в календаре бывает 53 недели" class="article-share-link">Поделиться</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Calendar/" rel="tag">Calendar</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GetWeekOfYear/" rel="tag">GetWeekOfYear</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ISOWeek/" rel="tag">ISOWeek</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/3/">&laquo; Назад</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/">Вперед &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Метки</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET5/" rel="tag">.NET5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET6/" rel="tag">.NET6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASP-NETCore/" rel="tag">ASP.NETCore</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/" rel="tag">Angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Benchmark/" rel="tag">Benchmark</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BenchmarkDotNet/" rel="tag">BenchmarkDotNet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Calendar/" rel="tag">Calendar</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ClearScript/" rel="tag">ClearScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Commandline/" rel="tag">Commandline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CreateReactApp/" rel="tag">CreateReactApp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DateTime/" rel="tag">DateTime</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DefaultRequestHeaders/" rel="tag">DefaultRequestHeaders</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EFCore5/" rel="tag">EFCore5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EFCore6/" rel="tag">EFCore6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EPPlus/" rel="tag">EPPlus</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ESLint/" rel="tag">ESLint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EntityFramework/" rel="tag">EntityFramework</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Enum/" rel="tag">Enum</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Excel/" rel="tag">Excel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GetWeekOfYear/" rel="tag">GetWeekOfYear</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Guid/" rel="tag">Guid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Headers/" rel="tag">Headers</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HttpClient/" rel="tag">HttpClient</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Husky/" rel="tag">Husky</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ILSpy/" rel="tag">ILSpy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ISOWeek/" rel="tag">ISOWeek</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JS/" rel="tag">JS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEFTJOIN/" rel="tag">LEFTJOIN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINQ/" rel="tag">LINQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MicrosoftSQLServer/" rel="tag">MicrosoftSQLServer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NSIS/" rel="tag">NSIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NuGet/" rel="tag">NuGet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OWIN/" rel="tag">OWIN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OrderBy/" rel="tag">OrderBy</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PostgreSQL/" rel="tag">PostgreSQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Prettier/" rel="tag">Prettier</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ProgressiveDelayPattern/" rel="tag">ProgressiveDelayPattern</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RPM/" rel="tag">RPM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SNMP/" rel="tag">SNMP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SPEC/" rel="tag">SPEC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SelectMany/" rel="tag">SelectMany</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stopwatch/" rel="tag">Stopwatch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swagger/" rel="tag">Swagger</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ToDictionary/" rel="tag">ToDictionary</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ToLookup/" rel="tag">ToLookup</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TopShelf/" rel="tag">TopShelf</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VSCode/" rel="tag">VSCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Venis-IX/" rel="tag">Venis_IX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VisualStudio/" rel="tag">VisualStudio</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WebAPI/" rel="tag">WebAPI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows-service/" rel="tag">Windows-service</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/aspnetcore/" rel="tag">aspnetcore</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/" rel="tag">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cursor/" rel="tag">cursor</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/get-request/" rel="tag">get-request</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/get-response/" rel="tag">get-response</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/githubpages/" rel="tag">githubpages</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/net5-0/" rel="tag">net5.0</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ngx-translate/" rel="tag">ngx-translate</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nsis/" rel="tag">nsis</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/paging/" rel="tag">paging</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pragmatic-programmer/" rel="tag">pragmatic-programmer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/printer/" rel="tag">printer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/script/" rel="tag">script</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scripting/" rel="tag">scripting</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/server/" rel="tag">server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/simulator/" rel="tag">simulator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snmp/" rel="tag">snmp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/snmpsim/" rel="tag">snmpsim</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/switch/" rel="tag">switch</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/syslog/" rel="tag">syslog</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/thread-safe/" rel="tag">thread-safe</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%A2%D0%BE%D0%BC%D0%B0%D1%81/" rel="tag">Томас</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%A5%D0%B0%D0%BD%D1%82/" rel="tag">Хант</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%B1%D0%BB%D0%BE%D0%B3/" rel="tag">блог</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%B4%D0%BE%D0%BA%D0%B5%D1%80/" rel="tag">докер</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D0%B5%D1%80/" rel="tag">принтер</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82-%D0%BF%D1%80%D0%B0%D0%B3%D0%BC%D0%B0%D1%82%D0%B8%D0%BA/" rel="tag">программист-прагматик</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D1%81%D0%B8%D0%BC%D1%83%D0%BB%D1%8F%D1%82%D0%BE%D1%80/" rel="tag">симулятор</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%D0%B1%D0%BB%D0%BE%D0%B3%D0%B0/" rel="tag">созданиеблога</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Облако меток</h3>
    <div class="widget tagcloud">
      <a href="/tags/NET5/" style="font-size: 10px;">.NET5</a> <a href="/tags/NET6/" style="font-size: 12.5px;">.NET6</a> <a href="/tags/ASP-NETCore/" style="font-size: 10px;">ASP.NETCore</a> <a href="/tags/Angular/" style="font-size: 10px;">Angular</a> <a href="/tags/Benchmark/" style="font-size: 10px;">Benchmark</a> <a href="/tags/BenchmarkDotNet/" style="font-size: 10px;">BenchmarkDotNet</a> <a href="/tags/C/" style="font-size: 20px;">C#</a> <a href="/tags/Calendar/" style="font-size: 10px;">Calendar</a> <a href="/tags/ClearScript/" style="font-size: 12.5px;">ClearScript</a> <a href="/tags/Commandline/" style="font-size: 10px;">Commandline</a> <a href="/tags/CreateReactApp/" style="font-size: 10px;">CreateReactApp</a> <a href="/tags/DateTime/" style="font-size: 10px;">DateTime</a> <a href="/tags/DefaultRequestHeaders/" style="font-size: 10px;">DefaultRequestHeaders</a> <a href="/tags/EFCore5/" style="font-size: 10px;">EFCore5</a> <a href="/tags/EFCore6/" style="font-size: 10px;">EFCore6</a> <a href="/tags/EPPlus/" style="font-size: 10px;">EPPlus</a> <a href="/tags/ESLint/" style="font-size: 10px;">ESLint</a> <a href="/tags/EntityFramework/" style="font-size: 12.5px;">EntityFramework</a> <a href="/tags/Enum/" style="font-size: 10px;">Enum</a> <a href="/tags/Excel/" style="font-size: 10px;">Excel</a> <a href="/tags/GetWeekOfYear/" style="font-size: 10px;">GetWeekOfYear</a> <a href="/tags/Guid/" style="font-size: 10px;">Guid</a> <a href="/tags/Headers/" style="font-size: 10px;">Headers</a> <a href="/tags/HttpClient/" style="font-size: 10px;">HttpClient</a> <a href="/tags/Husky/" style="font-size: 10px;">Husky</a> <a href="/tags/ILSpy/" style="font-size: 10px;">ILSpy</a> <a href="/tags/ISOWeek/" style="font-size: 10px;">ISOWeek</a> <a href="/tags/JS/" style="font-size: 12.5px;">JS</a> <a href="/tags/JavaScript/" style="font-size: 12.5px;">JavaScript</a> <a href="/tags/LEFTJOIN/" style="font-size: 10px;">LEFTJOIN</a> <a href="/tags/LINQ/" style="font-size: 17.5px;">LINQ</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MicrosoftSQLServer/" style="font-size: 15px;">MicrosoftSQLServer</a> <a href="/tags/NSIS/" style="font-size: 15px;">NSIS</a> <a href="/tags/NuGet/" style="font-size: 12.5px;">NuGet</a> <a href="/tags/OWIN/" style="font-size: 10px;">OWIN</a> <a href="/tags/OrderBy/" style="font-size: 10px;">OrderBy</a> <a href="/tags/PostgreSQL/" style="font-size: 15px;">PostgreSQL</a> <a href="/tags/Prettier/" style="font-size: 10px;">Prettier</a> <a href="/tags/ProgressiveDelayPattern/" style="font-size: 10px;">ProgressiveDelayPattern</a> <a href="/tags/RPM/" style="font-size: 12.5px;">RPM</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/SNMP/" style="font-size: 15px;">SNMP</a> <a href="/tags/SPEC/" style="font-size: 10px;">SPEC</a> <a href="/tags/SelectMany/" style="font-size: 10px;">SelectMany</a> <a href="/tags/Stopwatch/" style="font-size: 10px;">Stopwatch</a> <a href="/tags/Swagger/" style="font-size: 10px;">Swagger</a> <a href="/tags/ToDictionary/" style="font-size: 10px;">ToDictionary</a> <a href="/tags/ToLookup/" style="font-size: 10px;">ToLookup</a> <a href="/tags/TopShelf/" style="font-size: 10px;">TopShelf</a> <a href="/tags/VSCode/" style="font-size: 10px;">VSCode</a> <a href="/tags/Venis-IX/" style="font-size: 10px;">Venis_IX</a> <a href="/tags/VisualStudio/" style="font-size: 10px;">VisualStudio</a> <a href="/tags/WebAPI/" style="font-size: 10px;">WebAPI</a> <a href="/tags/Windows-service/" style="font-size: 12.5px;">Windows-service</a> <a href="/tags/aspnetcore/" style="font-size: 10px;">aspnetcore</a> <a href="/tags/bash/" style="font-size: 12.5px;">bash</a> <a href="/tags/concurrency/" style="font-size: 10px;">concurrency</a> <a href="/tags/cursor/" style="font-size: 10px;">cursor</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/get-request/" style="font-size: 10px;">get-request</a> <a href="/tags/get-response/" style="font-size: 10px;">get-response</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/githubpages/" style="font-size: 10px;">githubpages</a> <a href="/tags/net5-0/" style="font-size: 10px;">net5.0</a> <a href="/tags/ngx-translate/" style="font-size: 10px;">ngx-translate</a> <a href="/tags/nsis/" style="font-size: 15px;">nsis</a> <a href="/tags/paging/" style="font-size: 10px;">paging</a> <a href="/tags/pragmatic-programmer/" style="font-size: 10px;">pragmatic-programmer</a> <a href="/tags/printer/" style="font-size: 12.5px;">printer</a> <a href="/tags/script/" style="font-size: 12.5px;">script</a> <a href="/tags/scripting/" style="font-size: 10px;">scripting</a> <a href="/tags/server/" style="font-size: 10px;">server</a> <a href="/tags/simulator/" style="font-size: 12.5px;">simulator</a> <a href="/tags/snmp/" style="font-size: 12.5px;">snmp</a> <a href="/tags/snmpsim/" style="font-size: 12.5px;">snmpsim</a> <a href="/tags/switch/" style="font-size: 12.5px;">switch</a> <a href="/tags/syslog/" style="font-size: 10px;">syslog</a> <a href="/tags/thread-safe/" style="font-size: 10px;">thread-safe</a> <a href="/tags/%D0%A2%D0%BE%D0%BC%D0%B0%D1%81/" style="font-size: 10px;">Томас</a> <a href="/tags/%D0%A5%D0%B0%D0%BD%D1%82/" style="font-size: 10px;">Хант</a> <a href="/tags/%D0%B1%D0%BB%D0%BE%D0%B3/" style="font-size: 10px;">блог</a> <a href="/tags/%D0%B4%D0%BE%D0%BA%D0%B5%D1%80/" style="font-size: 10px;">докер</a> <a href="/tags/%D0%BF%D1%80%D0%B8%D0%BD%D1%82%D0%B5%D1%80/" style="font-size: 12.5px;">принтер</a> <a href="/tags/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%81%D1%82-%D0%BF%D1%80%D0%B0%D0%B3%D0%BC%D0%B0%D1%82%D0%B8%D0%BA/" style="font-size: 10px;">программист-прагматик</a> <a href="/tags/%D1%81%D0%B8%D0%BC%D1%83%D0%BB%D1%8F%D1%82%D0%BE%D1%80/" style="font-size: 12.5px;">симулятор</a> <a href="/tags/%D1%81%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5%D0%B1%D0%BB%D0%BE%D0%B3%D0%B0/" style="font-size: 10px;">созданиеблога</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Архив</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">февраль 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">август 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/07/">июль 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">июнь 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">апрель 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">декабрь 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">апрель 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">март 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">февраль 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">декабрь 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">ноябрь 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">октябрь 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">сентябрь 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">август 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">июль 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">июнь 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Недавние записи</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/02/01/update-json-node-in-sql/">Как изменить значение в JSON прочитав значение из другого узла с помощью SQL запроса</a>
          </li>
        
          <li>
            <a href="/2023/08/04/insert-node-to-json-by-sql/">Как добавить узел в JSON с помощью SQL запроса</a>
          </li>
        
          <li>
            <a href="/2023/07/05/system-drawing-common-only-windows-supported/">System.Drawing.Common будет поддерживаться только на Windows</a>
          </li>
        
          <li>
            <a href="/2023/06/27/nuget-cache-clearing/">Очистка кэша NuGet пакетов</a>
          </li>
        
          <li>
            <a href="/2023/06/25/select-problem-ngx-translate-angular/">Об одной проблеме работы ngx-translate при первоначальной загрузке сайта на Angular</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Artem Ostashchenko<br>
      Создано с помощью <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a target="_blank" rel="noopener" href="https://github.com/ostart/Skills" class="mobile-nav-link">My Skills</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>